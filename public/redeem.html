<!DOCTYPE html>
<html>
<head>
    <title>Organizer Token Redemption</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 2rem auto; padding: 0 1rem; }
        #reader { width: 100%; }
        #result { margin-top: 1rem; }
        button { padding: 10px 15px; font-size: 1rem; margin-top: 10px; }
    </style>
</head>
<body>

<h2>Scan Token QR Code for Redemption</h2>

<div id="reader"></div>

<div id="result"></div>

<script>
    function onScanSuccess(decodedText) {
   html5QrcodeScanner.clear();
   document.getElementById('result').textContent = "Checking token...";

   fetch('/.netlify/functions/redeem-token', {
     method: 'POST',
     headers: { 'Content-Type': 'application/json' },
     body: JSON.stringify({ tokenID: decodedText })
   })
   .then(res => res.text().then(text => ({ ok: res.ok, text })))
   .then(({ ok, text }) => {
     document.getElementById('result').innerHTML = ok
       ? `<span class="success">✅ ${text}</span>`
       : `<span class="error">❌ ${text}</span>`;
     setTimeout(() => {
       html5QrcodeScanner.render(onScanSuccess, onScanError);
     }, 2000);
   })
   .catch(err => {
     document.getElementById('result').innerHTML = `<span class="error">Error: ${err.message}</span>`;
     setTimeout(() => {
       html5QrcodeScanner.render(onScanSuccess, onScanError);
     }, 2000);
   });
 }

</script>

</body>
</html>
